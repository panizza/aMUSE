{% load staticfiles %}
{% load url from future %}
{% load thumbnail %}

<script src="{% static "js/image_viewer.js" %}" type="text/javascript"/>
<script>

    $(".open-modal").click(function(){
        var pk= $(this).data("pk");
        console.log(pk);
        var url = "{% url 'action_info' '123' %}".replace('123', pk)
        $.get(url, function(data) {
            $('<div class="modal hide fade my_modal" style="width:600px">' + data + '</div>').modal()
                    .on('hide',function(){
                        id = $("#gallery-content").data("pk");
                        $("#gallery-content").load("{% url 'action_list' 4269 %}".replace(4269,id));
                        $(this).remove();
                    })
            ;
        }).success(function() { $('input:text:visible:first').focus();
                });
    });
    $(".add-action").click(function(e){
        e.preventDefault();
        //var pk = $(this).data("pk");
        $("#gallery-content").load("{% url 'add_new_action' exp_id %}", function(){
            $('#gallery-content>form').attr("action", "{% url 'add_new_action' exp_id %}");
        });
    });

</script>
<ul id="gallery" class="gallery ui-helper-reset ui-helper-clearfix">
    {% for obj in lista %}
        <li class="ui-widget-content ui-corner-tr" data-pk="{{ obj.pk }}">
            {% if obj.photo != None %}
                {% thumbnail obj.photo "150x150" as im %}
                    <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
                {% endthumbnail %}
            {% endif%}
                <p>{{ obj.comment }}</p>
            {% if obj.scan != None %}
                <a href="{{ obj.photo.url }}" title="View larger image" class="ui-icon ui-icon-zoomin open-modal"
                   data-pk="{{ obj.pk }}">View larger</a>
            {% else %}
                <a href="{{ obj.photo.url }}" data-pk="{{ obj.pk }}" title="Edit item" class="ui-icon ui-icon-pencil open-modal">Edit this item</a>

            {% endif %}
            <a title="Delete this image" class="ui-icon ui-icon-trash trash-action">Delete</a>
        </li>
    {% endfor %}

</ul>
{% if not public %}
    <button class="btn btn-large btn-info add-action"  aria-hidden="true" data-pk="{{ exp_id }}">Add new action</button>

{% endif %}

